<%= stylesheet_link_tag    "attendances" %>
<%= javascript_include_tag "attendances" %>

<div class="wrapper">
  <%= header_messages :attendance %>
  <%= header_title t(".title") %>

  <div class="box-max-width">
    <div class="box">
      <div class="box-header">
        <div class="box-header-btn center">
          <%= link_to t(".prev_month"), prev_month_attendances_path(id:    @user.id,
                                                                    year:  @attendance.year,
                                                                    month: @attendance.month),
            class: "btn btn-lg pull-left" %>
          <%= link_to t(".next_month"), next_month_attendances_path(id:    @user.id,
                                                                    year:  @attendance.year,
                                                                    month: @attendance.month),
            class: "btn btn-lg pull-right" %>
        </div>
      </div>
      <%= form_for @attendance, url: { action: :save }, method: :post do |f| %>
        <%= hidden_field :user, :id %>
        <%= hidden_field :attendance, :year %>
        <%= hidden_field :attendance, :month %>
        <div class="box-body">
          <table class="table">
            <thead>
              <tr>
                <th>
                  <%= t(".entries_month") %>
                </th>
                <td>
                  <%= @attendance.entries_month %>
                </td>
                <th>
                  <%= t(".company_name") %>
                </th>
                <td>
                  <%= @sys.company_name %>
                </td>
              </tr>
              <tr>
                <th>
                  <%= t(".user_name") %>
                </th>
                <td>
                  <%= @user.name %>
                </td>
                <th>
                  <%= t(".affiliation") %>
                </th>
                <td>
                  <%= @user.affiliation_name %>
                </td>
              </tr>
              <tr>
                <th>
                  <%= t(".site_start_time") %>
                </th>
                <td>
                  <%= f.text_field :display_site_start_time,
                    class: "timepicker form-control" %>
                </td>
                <th>
                  <%= t(".site_end_time") %>
                </th>
                <td>
                  <%= f.text_field :display_site_end_time,
                    class: "timepicker form-control" %>
                </td>
              </tr>
              <tr>
                <th>
                  <%= t(".rest_start_time") %>
                </th>
                <td>
                  <%= f.text_field :display_rest_start_time,
                    class: "timepicker form-control" %>
                </td>
                <th>
                  <%= t(".rest_end_time") %>
                </th>
                <td>
                  <%= f.text_field :display_rest_end_time,
                    class: "timepicker form-control" %>
                </td>
              </tr>
              <tr>
                <th>
                  <%= t(".base_working_start_time") %>
                </th>
                <td>
                  <%= @sys.base_working_start_time %>
                </td>
                <th>
                  <%= t(".base_working_end_time") %>
                </th>
                <td>
                  <%= @sys.base_working_end_time %>
                </td>
              </tr>
              <% if @sys.enable_base_overtime_rest_time %>
                <tr>
                  <th>
                    <%= t(".base_overtime_rest_start_time") %>
                  </th>
                  <td>
                    <%= @sys.base_overtime_rest_start_time %>
                  </td>
                  <th>
                    <%= t(".base_overtime_rest_end_time") %>
                  </th>
                  <td>
                    <%= @sys.base_overtime_rest_end_time %>
                  </td>
                </tr>
              <% end %>
              <tr>
                <th>
                  <%= t(".late_night_time") %>
                </th>
                <td colspan="3">
                  <%= @sys.late_night_time %>
                </td>
              </tr>
            </thead>
          </table>
          <div class="form-group">
            <table class="table table-attendance">
              <tbody>
                <tr>
                  <th class="day">
                    <%= t(".day") %>
                  </th>
                  <th class="week">
                    <%= t(".week") %>
                  </th>
                  <th class="work-time">
                    <%= t(".work_start_time") %>
                  </th>
                  <th class="work-time">
                    <%= t(".work_end_time") %>
                  </th>
                  <th class="working-time">
                    <%= t(".working_time") %>
                  </th>
                  <th class="off-hours-time">
                    <%= t(".off_hours_time") %>
                  </th>
                  <th class="late-night-time">
                    <%= t(".late_night_time") %>
                  </th>
                  <th class="time-holiday">
                    <%= t(".time_holiday") %>
                  </th>
                  <th class="shortfall-time">
                    <%= t(".shortfall_time") %>
                  </th>
                  <th colspan="5" class="reason">
                    <%= t(".reason") %>
                  </th>
                  <th class="leave-type">
                    <%= t(".leave_type") %>
                  </th>
                  <th class="rest-out-of-standard">
                    <%= t(".rest_out_of_standard") %>
                  </th>
                </tr>
                <% @attendance.display_details.each do |detail| %>
                  <%= fields_for detail do |detail_form| %>
                    <%= detail_form.hidden_field :holiday_flag,
                      name: "attendance[display_details][#{detail.day}][holiday_flag]" %>
                    <tr class="<%= detail.holiday? ? 'holiday' : '' %>">
                      <td>
                        <%= detail.day %>
                      </td>
                      <td>
                        <%= t(".week_name_#{detail.week}") %>
                        <%= detail_form.hidden_field :week,
                          name: "attendance[display_details][#{detail.day}][week]" %>
                      </td>
                      <td>
                        <%= detail_form.text_field :work_start_time,
                          size:      "5",
                          maxlength: "5",
                          day:       detail.day,
                          class:     "timepicker form-control work_start_time",
                          name:      "attendance[display_details][#{detail.day}][work_start_time]" %>
                      </td>
                      <td>
                        <%= detail_form.text_field :work_end_time,
                          size:      "5",
                          maxlength: "5",
                          day:       detail.day,
                          class:     "timepicker form-control work_end_time",
                          name:      "attendance[display_details][#{detail.day}][work_end_time]" %>
                      </td>
                      <td>
                        <label id="working_time<%= detail.day %>"></label>
                      </td>
                      <td>

                      </td>
                      <td>

                      </td>
                      <td>
                        <%= detail_form.text_field :time_holiday,
                          size:      "5",
                          maxlength: "5",
                          class:     "timepicker form-control",
                          name:      "attendance[display_details][#{detail.day}][time_holiday]" %>
                      </td>
                      <td>

                      </td>
                      <td colspan="5">

                      </td>
                      <td>
                        <%= detail_form.collection_select :leave_type_id, @leave_types, :id, :content,
                          { include_blank: true },
                          {
                            class: "form-control",
                            name:  "attendance[display_details][#{detail.day}][leave_type_id]"
                          } %>
                      </td>
                      <td>
                        <%= detail_form.text_field :rest_out_of_standard,
                          size:      "5",
                          maxlength: "5",
                          class:     "timepicker form-control",
                          name:      "attendance[display_details][#{detail.day}][rest_out_of_standard]" %>
                      </td>
                    </tr>
                  <% end %>
                <% end %>
                <tr>
                  <th colspan="4" rowspan="2">
                    合計
                  </th>
                  <td rowspan="2">
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td rowspan="2">
                    -
                  </td>
                  <td rowspan="2">
                    -
                  </td>
                  <td rowspan="2">
                    -
                  </td>
                  <th>
                    年休
                  </th>
                  <th>
                    半休
                  </th>
                  <th>
                    振休
                  </th>
                  <th>
                    特有
                  </th>
                  <th>
                    特無
                  </th>
                  <th colspan="2">
                    欠勤
                  </th>
                </tr>
                <tr>
                  <td>
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td>
                    -
                  </td>
                  <td colspan="2">
                    -
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="box-footer">
          <%= f.submit t(".save"), class: "btn btn-lg pull-left" %>
          <%= link_to t(".export"), export_attendances_path(id:     @user.id,
                                                            year:   @attendance.year,
                                                            month:  @attendance.month),
            method: :post,
            class:  "btn btn-lg pull-right #{@attendance.new_record? ? 'disabled' : 'enable'}" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
