<div class="wrapper">
  <%= render "layouts/main_header" %>
  <%= render "layouts/main_sidebar" %>

  <div class="content-wrapper">
    <section class="content-header">
      <h1><%= t(".title") %></h1>
    </section>

    <section class="content">
      <%= render "shares/flash_messages" %>

      <div class="row">
        <div class="col-md-12">
          <div class="box">
            <div class="box-header with-border">
              <h3 class="box-title"><%= t(".list") %></h3>
            </div>
            <div class="box-body">
              <ul class="todo-list sortable">
                <% @reasons.each do |reason| %>
                  <li data-update_url="<%= update_orders_reason_path(reason) %>">
                    <span class="handle ui-sortable-handle">
                      <i class="fa fa-ellipsis-v"></i>
                      <i class="fa fa-ellipsis-v"></i>
                    </span>
                    <span class="text"><%= reason.content %></span>
                  </li>
                <% end %>
              </ul>
            </div>
            <div class="box-footer">
              <%= link_to t(".back"), reasons_path,
                method: :get,
                class:  "btn btn-primary btn-lg" %>
            </div>
            <div class="overlay hide">
              <i class="fa fa-refresh fa-spin"></i>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <%= render "layouts/main_footer" %>
</div>

<script type="text/javascript">
  $(function() {
    $(".sortable").sortable({
      axis:    "y",
      opacity: 0.5,
      handle:  ".handle",
      update: function(e, ui) {
        $(".overlay").removeClass("hide");
        var item        = ui.item;
        var item_data   = item.data();
        var params      = {};
        params.position = item.index();

        $.ajax({
          type:     "POST",
          url:      item_data.update_url,
          dataType: "json",
          data:     params,
          success: function(){
            $(".overlay").addClass("hide");
          }
        });
      }
    });
  });
</script>
